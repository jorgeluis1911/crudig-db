<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <title>CRUDig</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="/css/bootstrap.css" rel="stylesheet" media="screen">
    <link href="/css/bootstrap_modif.css" rel="stylesheet" media="screen">
    
    <script type="text/javascript" src="/js/jquery-1.10.1.min.js"></script>
    
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    
  </head>  
  <body>
    
    <!--  Menu principal -->
    <%= erb :'menus/_menuAdmin' , :locals => {:tablas => tablas,
                                               :enlaces => enlaces,
                                               :traductor => traductor,
                                               :idioma => idioma} %>
          
    <div class="container">
      
      <div id="mensaje">
        <% if message != '' %>
          <%= message%>
        <!--<div class="alert alert-success">
          <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>-->
        <% end %>
      </div>
      
      <div class="panel panel-default">
        <div class="panel-heading">
          <label><b>Configuraciones</b></label>
        </div>
        
        <table class="table table-condensed table-bordered">
      		<thead>
        		<tr class="info">
        		  <th>
        		    <a href="configuraciones"><span class="glyphicon glyphicon-refresh"></span></a>
        		    <a href="" class="btn btn-default btn-xs btn_a" 
                        data-toggle="modal" data-target="#agregarfila" onclick="agregar()">
                          <span class="glyphicon glyphicon-plus"></span>
                </a>
        		  </th>
        		  <% crudigTablas[configTabla]['columnas'].each do |col, value| %>
                  <th><%= col%></th>
                  <% if (value[:column_rel]) %>
                    <th><%= value[:tabla_rel]+'_'+value[:column_rel]%></th>
                  <% end %>
              <% end %>
        		</tr>
      		</thead>
          <tbody>
      			<% filas[configTabla].each do |key, en| %>
      			  <tr id="<%= key%>">
      			    <td width="110px">
                  <a href="/<%= idioma %>/config/update_id?id=<%= key%>" id="edit_save_<%= key%>" class="btn btn-default btn-xs btn_a">
                    <span class="glyphicon glyphicon-tasks" title="Configurar"></span></a>
        				  <a href="#" id="edit_save_<%= key%>" class="btn btn-default btn-xs btn_a"
        				    onclick="before_update('<%= key%>'); return false;">
        				    <span class="glyphicon glyphicon-pencil" title="Editar"></span></a>
        				  <a href="#" id="delete_cancel_<%= key%>" class="btn btn-default btn-xs btn_a"
        				    onclick="setIdEliminarModal('<%= key%>'); return false;"
        				    data-toggle="modal" data-target="#msgDelete">
                    <span class="glyphicon glyphicon-trash" title="Eliminar"></a>
                      <!--onclick="cancel_update('<%= key%>'); return false;"-->
                      
        					<!--<form action="/<%= configTabla%>/<%= key%>" method="post">
        						<input type="hidden" name="_method" value="delete" />
        						<input type="submit" value="Delete" class="btn btn-default"/>
        					</form>-->
        				</td>
        				<% en.each do |col, valor| %>
      				    <% if (crudigTablas[configTabla]['columnas'][col] && crudigTablas[configTabla]['columnas'][col][:column_rel]) %>
      				      <td>
      				        <a href="/<%= idioma %>/configuraciones/<%= crudigTablas[configTabla]['columnas'][col][:tabla_rel]%>/listar?<%= col+'='+valor%>"
      				          id="enlace_<%= col%>" idlista="<%= valor%>" combo="<%= col%>"><%= valor%></a>
      				          <!-- falta agregar el campo que visualiza el texto del enlace
      				            por defecto el la clave ajena
      				            -->
      				      </td>
      				    <% else %>
      				      <td fila="<%= col%>"><%= valor%></td>
      				    <% end %>
      				  <% end %>
      			  </tr>
      			<% end %>  			  
      		</tbody>
      	</table> 
      	<%= '<div class="alert alert-danger"> No tiene datos esta tabla </div>' if (filas[configTabla].length < 1) %>
      </div>

      <%= filas[:filas_detalle] %>
      
      <div class="panel panel-default">
        <div class="panel-heading">
          <label><b>Usuarios</b></label>
        </div>
        
        <table class="table table-condensed table-bordered">
          <thead>
            <tr class="info">
              <th>
                <a href="/<%= idioma %>/configuraciones/<%= usersTabla%>/listar"><span class="glyphicon glyphicon-refresh"></span></a>
                <a href="" class="btn btn-default btn-xs btn_a" 
                    data-toggle="modal" data-target="#agregarUser" onclick="agregar()">
                      <span class="glyphicon glyphicon-plus"></span>
                </a>
              </th>
              <% crudigTablas[usersTabla]['columnas'].each do |col, value| %>
                <th><%= col%></th>
                <% if (value[:column_rel]) %>
                  <th><%= value[:tabla_rel]+'_'+value[:column_rel]%></th>
                <% end %>
              <% end %>
            </tr>
          </thead>
          <tbody>                    
            <%#= filas[:filas_detalle] 
            %>
            <%  filas_detalle = {}
                if (filas[:filas_detalle][usersTabla])
                #if (filas[usersTabla])
                  filas_detalle = filas[:filas_detalle][usersTabla][usersTabla]
                end 
            %>
            <% filas_detalle.each do |key, en| %>
              <tr id="<%= usersTabla+key%>">
                <td>
                  <div class="btn-group">
                    <button type="button" class="btn btn-default btn-xs btn_a dropdown-toggle" data-toggle="dropdown">
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                      <li><a href="" data-toggle="modal" data-target="#editarUser">
                          Editar en ventana</a>
                      </li>
                      <%  ids = ''
                        en.each do |col, valor| 
                          if (crudigTablas[usersTabla]['columnas'][col] && crudigTablas[usersTabla]['columnas'][col][:column_key]=='PRI')
                            if(ids.eql? '')
                              ids = ids+col.to_s+'='+valor.to_s
                            else
                              ids = ids+'&'+col.to_s+'='+valor.to_s
                            end
                          end
                        end
                      %>
                      <li><a href="/<%= idioma %>/jerarquiaUp/<%= (usersTabla+'?'+ids) %>" target="_blank">
                        Jerarquía hacia arriba</a></li>
                      <li><a href="/<%= idioma %>/jerarquiaDown/<%= (usersTabla+'?'+ids) %>" target="_blank">
                        Jerarquía hacia abajo</a></li>
                    </ul>
                  </div>
                  
                  <a href="/<%= idioma %>/configuraciones/<%= usersTabla %>/<%= key %>" class="btn btn-default btn-xs btn_a"
                    onclick="before_update('<%= usersTabla+key%>'); return false;">
                    <span class="glyphicon glyphicon-pencil" title="Editar"></span></a>
                  <a href="/<%= idioma %>/configuraciones/<%= usersTabla %>/<%= key %>" class="btn btn-default btn-xs btn_a"
                    onclick="cancel_update('<%= usersTabla+key %>'); return false;">
                    <span class="glyphicon glyphicon-trash" title="Eliminar"></a>
                  <!--<form action="/<%= tabla%>/<%= key%>" method="post">
                    <input type="hidden" name="_method" value="delete" />
                    <input type="submit" value="Delete" class="btn btn-default"/>
                  </form>-->
                </td>
                <% en.each do |col, valor| %>
                  <% if (crudigTablas[usersTabla]['columnas'][col] && crudigTablas[usersTabla]['columnas'][col][:column_rel]) %>
                    <td>
                      <a href="/<%= idioma %>/configuraciones/<%= crudigTablas[usersTabla]['columnas'][col][:tabla_rel]%>/listar?<%= col+'='+valor%>"
                        id="enlace_<%= col%>" combo="<%= col%>"><%= valor%></a></td>
                  <% else %>
                    <td fila="<%= col%>"><%= valor%></td>
                  <% end %>
                <% end %>
              </tr>
            <% end %>   
          </tbody>
        </table>
        <%= '<div class="alert alert-danger">No tiene datos esta tabla </div>' if (filas_detalle.length < 1) %>
      </div>


      <div class="panel panel-default">
        <div class="panel-heading">
          <label><b>Roles</b></label>
        </div>
        
        <table class="table table-condensed table-bordered">
          <thead>
            <tr class="info">
              <th>
                <a href="/<%= idioma %>/configuraciones/<%= rolesTabla%>/listar"><span class="glyphicon glyphicon-refresh"></span></a>
                <a href="" class="btn btn-default btn-xs btn_a" 
                    data-toggle="modal" data-target="#agregarRole" onclick="agregar()">
                      <span class="glyphicon glyphicon-plus"></span>
                </a>
              </th>
              <% crudigTablas[rolesTabla]['columnas'].each do |col, value| %>
                <th><%= col%></th>
                <% if (value[:column_rel]) %>
                  <th><%= value[:tabla_rel]+'_'+value[:column_rel]%></th>
                <% end %>
              <% end %>
            </tr>
          </thead>
          <tbody>                    
            <%#= filas[:filas_detalle] 
            %>
            <%  filas_detalle = {}
                if (filas[:filas_detalle][rolesTabla])
                #if (filas[rolesTabla])
                  filas_detalle = filas[:filas_detalle][rolesTabla][rolesTabla]
                end 
            %>
            <% filas_detalle.each do |key, en| %>
              <tr id="<%= rolesTabla+key%>">
                <td>
                  <div class="btn-group">
                    <button type="button" class="btn btn-default btn-xs btn_a dropdown-toggle" data-toggle="dropdown">
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                      <li><a href="" data-toggle="modal" data-target="#editarfila" >
                          Editar en ventana</a>
                      </li>
                      <%  ids = ''
                        en.each do |col, valor| 
                          if (crudigTablas[rolesTabla]['columnas'][col] && crudigTablas[rolesTabla]['columnas'][col][:column_key]=='PRI')
                            if(ids.eql? '')
                              ids = ids+col.to_s+'='+valor.to_s
                            else
                              ids = ids+'&'+col.to_s+'='+valor.to_s
                            end
                          end
                        end
                      %>
                      <li><a href="/<%= idioma %>/jerarquiaUp/<%= (rolesTabla+'?'+ids) %>" target="_blank">
                        Jerarquía hacia arriba</a></li>
                      <li><a href="/<%= idioma %>/jerarquiaDown/<%= (rolesTabla+'?'+ids) %>" target="_blank">
                        Jerarquía hacia abajo</a></li>
                    </ul>
                  </div>
                  
                  <a href="/<%= idioma %>/configuraciones/<%= rolesTabla %>/<%= key %>" class="btn btn-default btn-xs btn_a"
                    onclick="before_update('<%= rolesTabla+key%>'); return false;">
                    <span class="glyphicon glyphicon-pencil" title="Editar"></span></a>
                  <a href="/<%= idioma %>/configuraciones/<%= rolesTabla %>/<%= key %>" class="btn btn-default btn-xs btn_a"
                    onclick="cancel_update('<%= rolesTabla+key %>'); return false;">
                    <span class="glyphicon glyphicon-trash" title="Eliminar"></a>
                  <!--<form action="/<%= tabla%>/<%= key%>" method="post">
                    <input type="hidden" name="_method" value="delete" />
                    <input type="submit" value="Delete" class="btn btn-default"/>
                  </form>-->
                </td>
                <% en.each do |col, valor| %>
                  <% if (crudigTablas[rolesTabla]['columnas'][col] && crudigTablas[rolesTabla]['columnas'][col][:column_rel]) %>
                    <td>
                      <a href="/<%= idioma %>/configuraciones/<%= crudigTablas[rolesTabla]['columnas'][col][:tabla_rel]%>/listar?<%= col+'='+valor%>"
                        id="enlace_<%= col%>" combo="<%= col%>"><%= valor%></a></td>
                  <% else %>
                    <td fila="<%= col%>"><%= valor%></td>
                  <% end %>
                <% end %>
              </tr>
            <% end %>   
          </tbody>
        </table>
        <%= '<div class="alert alert-danger">No tiene datos esta tabla </div>' if (filas_detalle.length < 1) %>
      </div>
      
            
    </div> 

<!--    Configuraciones   -->
            
      <!-- Modal Agregar-->
      
      <div class="modal fade" id="agregarfila" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Nuevo registro de <%= configTabla%></h4>
            </div>
            <div class="modal-body">
              <form method="post" action="/configuraciones/<%= configTabla%>/create_json" id="agregarform" name="agregarform" 
                  class="form-horizontal" enctype="multipart/form-data">
                    <% crudigTablas[configTabla]['columnas'].each do |col, value| %>
                    <div class="form-group">
                      <label for="<%= col%>" class="col-sm-2 control-label"><%= col%></label>
                      <div class="col-sm-10">
                      <% if (value[:column_rel]) %>
                          <select class="form-control" id="<%= col%>" name="<%= col%>" required>
                            <% filas[value[:tabla_rel]].each do |id, fila| %>
                                <option value="<%= fila[value[:column_rel]]%>" 
                                  <%= 'selected' if (params[col].eql?(fila[value[:column_rel]]))%> >
                                  <%= fila[value[:column_rel]]%></option>
                            <% end %>
                          </select>
                      <% elsif(value[:es_archivo].eql?('1')) %>
                          <input class="form-control" type="file" id="<%= col%>" name="<%= col%>" />
                      <% else %>
                        <input type="search" id="<%= col%>" name="<%= col%>" value="<%= params[col]%>" 
                            maxlength="<%= value[:length] if value[:length]%>" class="form-control"
                            <%= 'required' if value[:column_key]=='PRI' %>/>
                      <% end %>
                      </div>
                    </div>
                    <% end %>
                <br />
      
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <input type="submit" name="agregarbtn" class="btn btn-info" value="Crear Nuevo">
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal Editar-->
      
      <div class="modal fade" id="editarfila" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 600px;">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Nuevo registro de <%= configTabla%></h4>
            </div>
            <div class="modal-body">
              <form method="get" action="/configuraciones/<%= configTabla%>/update_id_json" id="editarform" name="editarform" 
                  class="form-horizontal" role="form">
                    <% crudigTablas[configTabla]['columnas'].each do |col, value| %>
                    <div class="form-group">
                      <label for="inputEmail3" class="col-sm-2 control-label">Email</label>
                      <div class="col-sm-10">
                      <% if (value[:column_rel]) %>
                          <select class="form-control" id="<%= col%>" name="<%= col%>" >
                            <% filas[value[:tabla_rel]].each do |id, fila| %>
                                <option value="<%= fila[value[:column_rel]]%>" 
                                  <%= 'selected' if (params[col].eql?(fila[value[:column_rel]]))%> >
                                  <%= fila[value[:column_rel]]%></option>
                            <% end %>
                          </select>
                      <% else %>
                        <input type="search" id="<%= col%>" name="<%= col%>" value="<%= params[col]%>" 
                            maxlength="<%= value[:length] if value[:length]%>" class="form-control"/>
                      <% end %>
                      </div>
                    </div>
                    <% end %>
                <br />
      
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <input type="submit" name="editarbtn" class="btn btn-info" value="Guardar Cambios">
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- desea editar -->
      <div class="modal fade" id="msgUpdate" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 400px;">
          <div class="modal-content">
            <div class="modal-body">
              <h4>¿Seguro que desea actualizar estos datos?</h4>
              <button type="submit" class="btn btn-info" data-dismiss="modal" id="update_boton"
                onclick="final_update('', true); return false;" >Sí, actualizar los datos</button>
              <button type="button" class="btn btn-default" data-dismiss="modal" id="cancel_boton"
                onclick="final_update('', false); return false;" >No, cancelar datos</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">No, cerrar</button>
            </div>
          </div>
        </div>
      </div>
      
      
      <!-- desea eliminar -->
      <div class="modal fade" id="msgDelete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 400px;">
          <div class="modal-content">
            <div class="modal-body">
              <h4>¿Seguro que desea eliminar estos datos?</h4>
              <button type="submit" class="btn btn-info" data-dismiss="modal" id="delete_boton"
                onclick="eliminar_fila('', true); return false;" >Sí, eliminar los datos</button>
              <button type="button" class="btn btn-default" data-dismiss="modal" >No, cancelar</button>
            </div>
          </div>
        </div>
      </div>      
      

<!--    Usuarios      -->
            
      <!-- Modal Agregar-->
      
      <div class="modal fade" id="agregarUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Nuevo registro de <%= usersTabla%></h4>
            </div>
            <div class="modal-body">
              <form method="post" action="/configuraciones/<%= usersTabla%>/create_json" id="agregarform" name="agregarform" 
                  class="form-horizontal" enctype="multipart/form-data">
                    <% crudigTablas[usersTabla]['columnas'].each do |col, value| %>
                    <div class="form-group">
                      <label for="<%= col%>" class="col-sm-2 control-label"><%= col%></label>
                      <div class="col-sm-10">
                      <% if (value[:column_rel]) %>
                          <select class="form-control" id="<%= col%>" name="<%= col%>" required>
                            <% filas[value[:tabla_rel]].each do |id, fila| %>
                                <option value="<%= fila[value[:column_rel]]%>" 
                                  <%= 'selected' if (params[col].eql?(fila[value[:column_rel]]))%> >
                                  <%= fila[value[:column_rel]]%></option>
                            <% end %>
                          </select>
                      <% elsif(value[:es_archivo].eql?('1')) %>
                          <input class="form-control" type="file" id="<%= col%>" name="<%= col%>" />
                      <% else %>
                        <input type="search" id="<%= col%>" name="<%= col%>" value="<%= params[col]%>" 
                            maxlength="<%= value[:length] if value[:length]%>" class="form-control"
                            <%= 'required' if value[:column_key]=='PRI' %>/>
                      <% end %>
                      </div>
                    </div>
                    <% end %>
                <br />
      
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <input type="submit" name="agregarbtn" class="btn btn-info" value="Crear Nuevo">
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal Editar-->
      
      <div class="modal fade" id="editarUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 600px;">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Nuevo registro de <%= usersTabla%></h4>
            </div>
            <div class="modal-body">
              <form method="get" action="/configuraciones/<%= usersTabla%>/update_id_json" id="editarform" name="editarform" 
                  class="form-horizontal" role="form">
                    <% crudigTablas[usersTabla]['columnas'].each do |col, value| %>
                    <div class="form-group">
                      <label for="inputEmail3" class="col-sm-2 control-label">Email</label>
                      <div class="col-sm-10">
                      <% if (value[:column_rel]) %>
                          <select class="form-control" id="<%= col%>" name="<%= col%>" >
                            <% filas[value[:tabla_rel]].each do |id, fila| %>
                                <option value="<%= fila[value[:column_rel]]%>" 
                                  <%= 'selected' if (params[col].eql?(fila[value[:column_rel]]))%> >
                                  <%= fila[value[:column_rel]]%></option>
                            <% end %>
                          </select>
                      <% else %>
                        <input type="search" id="<%= col%>" name="<%= col%>" value="<%= params[col]%>" 
                            maxlength="<%= value[:length] if value[:length]%>" class="form-control"/>
                      <% end %>
                      </div>
                    </div>
                    <% end %>
                <br />
      
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <input type="submit" name="editarbtn" class="btn btn-info" value="Guardar Cambios">
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- desea editar -->
      <div class="modal fade" id="msgUpdateUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 400px;">
          <div class="modal-content">
            <div class="modal-body">
              <h4>¿Seguro que desea actualizar estos datos?</h4>
              <button type="submit" class="btn btn-info" data-dismiss="modal" id="update_boton"
                onclick="final_update('', true); return false;" >Sí, actualizar los datos</button>
              <button type="button" class="btn btn-default" data-dismiss="modal" id="cancel_boton"
                onclick="final_update('', false); return false;" >No, cancelar datos</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">No, cerrar</button>
            </div>
          </div>
        </div>
      </div>
      
      
      <!-- desea eliminar -->
      <div class="modal fade" id="msgDeleteUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 400px;">
          <div class="modal-content">
            <div class="modal-body">
              <h4>¿Seguro que desea eliminar estos datos?</h4>
              <button type="submit" class="btn btn-info" data-dismiss="modal" id="delete_boton"
                onclick="eliminar_fila('', true); return false;" >Sí, eliminar los datos</button>
              <button type="button" class="btn btn-default" data-dismiss="modal" >No, cancelar</button>
            </div>
          </div>
        </div>
      </div>      


<!--    Roles     -->
      
      
      <div class="modal fade" id="agregarRole" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 700px;">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Nuevo registro de Rol</h4>
            </div>
            <div class="modal-body">
              <form method="post" action="/configuraciones/config_roles/create_json" id="agregarform" name="agregarform" 
                  class="form-horizontal" enctype="multipart/form-data">
                
                <div class="form-group">
                  <label for="" class="col-sm-3 control-label">Nombre del Rol</label>
                  <div class="col-sm-9">
                    <input type="search" id="" name="" value="" maxlength="" class="form-control" required/>
                  </div>
                </div>
                
                <br />
                
                <table width="100%">
                  <thead>
                    <tr><th><a>- Tablas +</a></th>
                      <th style="width: 55px;"><a>- crear +</a></th>
                      <th style="width: 45px;"><a>- leer +</a></th>
                      <th style="width: 75px;"><a>- modificar +</a></th>
                      <th style="width: 70px;"><a>- eliminar +</a></th>
                      
                      <th style="width: 75px;"><a>- informes +</a></th>
                      <th style="width: 70px;"><a>- gráficos +</a></th>
                      <th style="width: 75px;"><a>- refrescar +</a></th>
                    </tr>
                  </thead>
                  <tbody style="text-align: center;">
                    <tr><td><a>- nom_tabla +</a></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                    </tr>
                    <tr><td>nom_tabla</td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                    </tr>
                    <tr><td>nom_tabla</td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                    </tr>
                    <tr><td>nom_tabla</td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                      <td><input type="checkbox" id="_combo_string" name="_combo_string"
                        <%= 'checked' if (1) %>/></td>
                    </tr>
                  </tbody>
                </table>
                
                <br /><br />
                
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <input type="submit" name="agregarbtn" class="btn btn-info" value="Crear Nuevo">
              </form>
            </div>
          </div>
        </div>
      </div>
            
      


      <script>
      
        $("#agregarform").submit(function( event ) {
          // Stop form from submitting normally
          event.preventDefault();
         
          // Get some values from elements on the page:
          var $form = $( this ),
            term = $form.serialize(),
            url = $form.attr( "action" );
         
          // Send the data using post
          $.getJSON( url, term )         
              .done(function( json ) {
                //var content = $(data).find("#content");
                //if (json["valido"] == 1) {
                if (json.valido == '1') {
                  $("#mensaje").empty().append('<div class="alert alert-success">'+
                    '<button type="button" class="close" data-dismiss="alert">&times;</button>'+json.mensaje+'</div>');
                }else{
                  $("#mensaje").empty().append('<div class="alert alert-danger">'+
                    '<button type="button" class="close" data-dismiss="alert">&times;</button>'+json.mensaje+'</div>');
                }
              })
              .fail(function( jqxhr, textStatus, error ) {
                $("#mensaje").empty().append('<div class="alert alert-danger">'+
              '<button type="button" class="close" data-dismiss="alert">&times;</button>'+textStatus+", "+error+'</div>');
          });
          $("#agregarfila").modal('hide');
          return false;
        });  
        
        
        function before_update(id){
          var cells = document.getElementById(id).getElementsByTagName('td');
          var texto = '';
          var hijos;
          for(var i=1; i<cells.length; i+=1){
            nameCol= cells[i].getAttribute("fila");
            texto = '<input type="text" id="" name="'+nameCol+'" class="form-control" ';
            texto += 'oldvalue="'+cells[i].innerHTML+'" value="'+cells[i].innerHTML+'"/>';
            
            hijos = cells[i].getElementsByTagName('a');
            if( hijos && hijos.length > 0) {
              //texto = cells[i].firstChild.innerHTML;
              var combo_id = hijos[0].getAttribute('combo');
              var idlista = hijos[0].getAttribute('idlista');
              texto = document.getElementById(combo_id).cloneNode(true);
              
              for(var j = 0; j < texto.length; j++){
                if(texto.options[j].value == idlista)
                  texto.selectedIndex = j;
              }
              //texto.value = idfila;
              texto.setAttribute("name=", nameCol);
              texto.setAttribute("enlace", hijos[0].href);
              texto.setAttribute("oldvalue", idlista);
              //texto.value = idfila;
              cells[i].innerHTML = "";
              cells[i].appendChild(texto);
              
              texto = texto.outerHTML;
            } else {
              cells[i].innerHTML = texto;
            }
          }
          cambiar_span('delete_cancel_'+id, id, 'glyphicon glyphicon-remove', 'Cancelar', 'cancel_update');
          cambiar_span('edit_save_'+id, id, 'glyphicon glyphicon-save', 'Guardar', 'final_update');
          return false;
        }
        
        function changeRowUpdated(id){
          var cells = document.getElementById(id).getElementsByTagName('td');
          var texto = '';
          var hijos;
          for(var i=1; i<cells.length; i+=1){
            texto = cells[i].firstChild.value;
            hijos = cells[i].getElementsByTagName('select');
            if( hijos && hijos.length > 0) {
              texto = '<a href="'+hijos[0].getAttribute('enlace')+'" id="enlace_'+hijos[0].id+'" ';
              texto += 'idlista="'+hijos[0].value+'" combo="'+hijos[0].id+'">';
              texto += hijos[0].options[hijos[0].selectedIndex].text+'</a>';
            }
            cells[i].innerHTML = texto;
          }
          cambiar_span('delete_cancel_'+id, id, 'glyphicon glyphicon-trash', 'Eliminar', 'eliminar_fila');
          cambiar_span('edit_save_'+id, id, 'glyphicon glyphicon-pencil', 'Editar', 'before_update');
          
          document.getElementById(id).setAttribute("style","background-color: #dff0d8;");
          setMensaje("Datos modificados con éxito", "success");
        }
        
        function final_update(id, actualizar){
          //  seguro que quieres guardar
          
          if(actualizar == true){
            //  si
            var formEdit = document.getElementById("form_editar_"+id);
            //alert(document.getElementById(id).innerHTML )
            alert(formEdit.action+mySerialize(id))
            url = formEdit.action+mySerialize(id)
            $.getJSON( url )
              .done(function(data) {
                alert( "bien--"+data );
                changeRowUpdated(id);
              })
              .fail(function(data) {
                alert( data.mensaje );
                setMensaje("Error al actualizar los datos", "danger");
              });            
          }else if(actualizar == false){
            //  no          
            cancel_update(id);
          }
          return false;
        }
        
        function mySerialize(id){
          var params = "?";
          var tr = document.getElementById(id);
          var inputs = tr.getElementsByTagName("input");
          var combos = tr.getElementsByTagName("select");
          
          for(var i=0; i < inputs.length; i+=1){
            params += "&"+inputs[i].getAttribute("name")+'='+inputs[i].value;
          }
          for(var i=0; i < combos.length; i+=1){
            params += "&"+combos[i].getAttribute("name")+'='+inputs[i].value;
          }
          return params;
        }
        
        function cancel_update(id){
          var cells = document.getElementById(id).getElementsByTagName('td');
          var texto = '';
          var hijos;
          for(var i=1; i<cells.length; i+=1){
            texto = cells[i].firstChild.getAttribute("oldvalue");
            hijos = cells[i].getElementsByTagName('select');
            if( hijos && hijos.length > 0) {
              texto = '<a href="/<%= idioma %>/employees/listar?emp_no='+hijos[0].getAttribute("oldvalue")+'" id="enlace_'+hijos[0].id+'" ';
              texto += 'idlista="'+hijos[0].getAttribute("oldvalue")+'" combo="'+hijos[0].id+'">';
              
              for(var j = 0; j < hijos[0].length; j++){
                if(hijos[0].options[j].value == hijos[0].getAttribute("oldvalue"))
                  texto += hijos[0].options[j].text;
              }
              texto += '</a>';
            }
            cells[i].innerHTML = texto;
          }
          cambiar_span('delete_cancel_'+id, id, 'glyphicon glyphicon-trash', 'Eliminar', 'eliminar_fila');
          cambiar_span('edit_save_'+id, id, 'glyphicon glyphicon-pencil', 'Editar', 'before_update');
          return false;
        }
        
        
        function eliminar_fila(id, eliminar){
          //  seguro que quieres elimninar
          if(eliminar == true) {
            document.getElementById(id).innerHTML = "";
            setMensaje("Datos eliminados con éxito", "success");
          }
        }
        
        
        function cambiar_span(hrefid, id, icono, title, func){
          var span = '<span class="'+icono+'" title="'+title+'"></span>';
          //span += 'onclick="'+func+'('+id+'); return false;"" > </span>';
          var href = document.getElementById(hrefid);
          
          if(func == 'eliminar_fila' || func == 'final_update'){
            href.onclick = function(){};
            href.setAttribute("data-toggle","modal");
            
            if(func == 'eliminar_fila'){
              href.onclick = function(){eval("setIdEliminarModal("+id+");")};
              
              href.setAttribute("data-target","#msgDelete");
            
            }else{
              var clicModalSi = "final_update('"+id+"', true);";
              var clicModalNo = "final_update('"+id+"', false);";
              document.getElementById('update_boton').onclick = function(){ eval( clicModalSi )};
              document.getElementById('cancel_boton').onclick = function(){ eval( clicModalNo )};
              
              href.setAttribute("data-target","#msgUpdate");
            }
          }else{
            href.setAttribute("data-toggle","");
            href.setAttribute("data-target","");
            href.onclick = function(){ eval(''+func+'(\''+id+'\')'); return false;};
          }
          href.innerHTML = span;
        }
        
        function agregar(){
          
        }
        
        function setMensaje(sms, type){
          var msg = '<div class="alert alert-'+type+'">';
          msg += '<button type="button" class="close" data-dismiss="alert">&times;</button>';
          msg += sms+'</div>';
          document.getElementById('mensaje').innerHTML = msg;
        }
        
        function setIdEliminarModal(id){
          var clicDelete = "eliminar_fila('"+id+"', true);";
              
          document.getElementById('delete_boton').onclick = function(){ eval( clicDelete )};
        }
        
        $(function () {
          tab = '<%= params[:g_g]%>';
          
          if (tab == '') $('#detalle_grid a:first').tab('show')
          else           $('#detalle_grid a[href="#<%= params[:g_g]%>"]').tab('show')
        })
        
        
        //  funciones grids tabs
        
        function buscar_tabs( form_id ){
          var url = $( "#"+form_id ).attr('action');
                    
          var jqxhr = $.post( url, $( "#"+form_id ).serialize())
            .done(function( hash_json ) {
              alert( "success - "+ form_id +' - '+ url +'?'+  $( "#"+form_id ).serialize() );
              alert( hash_json );
            })
            .fail(function() {
              //alert( ".No se puede realizar la busqueda ahroa." );
              alert( url +'?'+  $( "#"+form_id ).serialize());
            });
          event.preventDefault();
          return false;
        }

      </script>
      
  </body>
</html>